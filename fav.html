<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Favorites</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <link
      href="https://fonts.googleapis.com/css2?family=Unbounded:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <link href="css/bootstrap.min.css" rel="stylesheet" />

    <link href="css/bootstrap-icons.css" rel="stylesheet" />

    <link href="css/templatemo-ebook-landing.css" rel="stylesheet" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./css/tryy.css" />
    <script
      src="https://kit.fontawesome.com/YOUR_FONT_AWESOME_KEY.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <h1>My Favorite Books</h1>
    <div
      id="favoritesContainer"
      class="book-cards"
      style="display: flex; flex-wrap: wrap"
    ></div>
    <script>
      window.onload = function () {
        const currentUser = localStorage.getItem("currentUser"); // استرجاع currentUser
        if (!currentUser) {
          alert("Please log in to view favorites.");
          return;
        }

        let readers_log = JSON.parse(localStorage.getItem("readers_log")) || [];
        let userIndex = readers_log.findIndex(
          (user) => user.email === currentUser
        );

        if (
          userIndex !== -1 &&
          Array.isArray(readers_log[userIndex].fav_books)
        ) {
          const container = document.getElementById("favoritesContainer");
          readers_log[userIndex].fav_books.forEach((book) => {
            const card = document.createElement("div");
            card.className = "col-md-4 card";
            card.setAttribute("data-id", book.id);

            const img = document.createElement("img");
            img.src = book.imgSrc;
            img.alt = "Book Cover";
            img.className = "d-block w-100";

            const info = document.createElement("div");
            info.innerHTML = book.more + book.love;
            info.className = "info";

            const heartButton = info.querySelector(".heart");
            if (heartButton) {
              heartButton.classList.add("liked");
              heartButton.addEventListener("click", () => {
                removeFromFavorites(book.id);
              });
            }

            card.appendChild(img);
            card.appendChild(info);

            container.appendChild(card);
          });
        }
      };

      function removeFromFavorites(bookId) {
        const currentUser = localStorage.getItem("currentUser"); // استرجاع currentUser
        if (!currentUser) {
          alert("Please log in to remove favorites.");
          return;
        }

        let readers_log = JSON.parse(localStorage.getItem("readers_log")) || [];
        let userIndex = readers_log.findIndex(
          (user) => user.email === currentUser
        );

        if (userIndex !== -1) {
          let favorites = readers_log[userIndex].fav_books;
          favorites = favorites.filter((book) => book.id !== bookId);
          readers_log[userIndex].fav_books = favorites;

          localStorage.setItem("readers_log", JSON.stringify(readers_log));
          window.location.reload();
        }
      }
    </script>

    <script src="js/bootstrap.bundle.min.js"></script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
